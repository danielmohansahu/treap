#!/usr/bin/env python
""" Run full suite of assignments for ENPM809X Project.
""" 

import random
from pytreap.treap import Treap

def is_ordered(treap):
    """ Utility to check that every node in the given Treap satisfies the following:
    Rules:
     - if v is a child of u, then v.priority <= u.priority
     - if v is a left child of u, then v.key < u.key
     - if v is a right child of u, then v.key > u.key
    """
    # iterate through all nodes in the heap
    for node in treap:
        # check parent (if not root)
        if node != treap.root and (node.priority > node.parent.priority):
            print("Node {} and parent ({}) have mismatched priorities.".format(node, node.parent))
            return False
        # check left and right. All are optional, technically
        if node.left and (node.key < node.left.key):
            print("Node {} and left child ({}) have mismatched keys.".format(node, node.left))
            return False
        if node.right and (node.key > node.right.key):
            print("Node {} and right child ({}) have mismatched keys.".format(node, node.right))
            return False
    return True

if __name__ == "__main__":
    # seed random priorities
    random.seed()

    ###############################################################################################
    ##################################### Part #3 #################################################
    ###############################################################################################
    statement = """
    Use TreapInsert to build a treap using uppercase letters as keys, received in the
    following order:

    {'Z','Y','X','W','V','Q','U','P','S','R','K','J','G','B',
    'F','C','M','D','H','I','L','A','N','O','T','E'}
    
    Use randomly generated treap priorities for each letter.

    Verify that your treap indeed satisfies the binary search tree and heap priorities.
    """
    print("Step #3 Problem Statement: \n{}".format(statement))

    # construct the desired treap (priorities are generated randomly implicitly)
    treap = Treap()

    # add all the keys
    keys = ('Z','Y','X','W','V','Q','U','P','S','R','K','J','G','B',
            'F','C','M','D','H','I','L','A','N','O','T','E')
    for key in keys:
        treap.insert(key)

    # print out the resulting treap
    treap.display()

    # check that this satisfies our conditions
    if is_ordered(treap):
        print("\nSUCCESS: Resulting treap satisfies our conditions.\n")
    else:
        print("\nERROR: Resulting treap is not ordered properly. Something went wrong.\n")
    
    ###############################################################################################
    ##################################### Part #4 #################################################
    ###############################################################################################
    statement="""
    Write a program that will read the file “textbook.txt” character by character, which
    contains the preface of your textbook repeated several times. For each uppercase
    character (“A-Z”) that is read, use TreapSearch function to search your treap for that
    character (which should always find a match). For each lowercase character (“a-z”) that
    is read, convert it to uppercase and then use TreapSearch function to search your
    treap (again, it should always find a match). Skip all other characters that are read.
    Measure the total time it takes for searching all letters in the file.
    
    Run your program 5 times to get 5 measurement values, and then calculate the average
    of your measurements.
    """
    print("Step #4 Problem Statement: \n{}".format(statement))


    ###############################################################################################
    ##################################### Part #5 #################################################
    ###############################################################################################
    statement="""
    Repeat steps 3 and 4 above, using the following priorities when generating the treap,
    instead of random priorities. These priorities roughly correspond to average frequency
    of each letter in English. When generating the treap, the characters should still be
    received in the order specified in step 3.

    Characters: A,B, C, D, E, F,G, H, I, J,K, L, M, N, O, P,Q, R, S, T, U,V,W,X,Y,Z
    Priorities: 24,7,14,17,26,10,8,18,22,4,5,16,13,19,23,12,2,20,21,25,15,6,11,3,9,1

    Run your program 5 times and calculate the average of your time measurements as in
    step 4. Does using priorities corresponding to letter frequency improve the running
    time?
    """
    print("Step #5 Problem Statement: \n{}".format(statement))


    ###############################################################################################
    ##################################### Part #6 #################################################
    ###############################################################################################
    statement="""
    Repeat steps 3 and 4 above, without using any priorities when generating the treap,
    thus generating a simple binary search tree. Depending on your implementation, one
    way to do this may be assigning the same priority to all characters when calling the
    TreapInsert function. When generating the tree, the characters should still be
    received in the order specified in step 3.

    Run your program 5 times and calculate the average of your time measurements as in
    steps 4 and 5. Does using treaps improve the running time compared to a binary search
    tree?
    """
    print("Step #6 Problem Statement: \n{}".format(statement))


